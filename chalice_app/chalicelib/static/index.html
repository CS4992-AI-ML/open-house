<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Open House Frontend</title>
      <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
     <style>
      .highlighted:focus {
        background-color: rgba(255, 0, 0, 0.1);
        outline: 2px solid #DE4040FF;
      }
      .button {
        padding: 10px 20px;
        background-color: #de4040;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }
      .box-left {
      background-color: #de4040;
      color: #ffffff;
      width: 30%;
      height: 100vh;
      border: none;
      overflow-y: auto;
    }

      .box-right {
        background-color: #ffffff;
        color: #ff0000;
        border: none;
        width: 70%;
        overflow-y: auto;
        height: 100%;
        padding: 4% 7%;
      }

      body {
        background-color: #ffffff;
        margin: 0;
        padding: 0;
        height: 100vh;
      }
      .input-field {
        background-color: #ffffff;
        border: 1px solid #ff0000;
      }
      .input-title {
        font-weight: bold;
      }
      .link {
        text-decoration: underline;
      }

      .graph img {
        height: 400px;
        width: auto;
      }

     .team-section {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.team-member {
  width: calc(50% - 0.5rem);
  box-sizing: border-box;
  text-align: center;
  margin-bottom: 1rem;
}

.team-member img {
  width: 120px;
  height: 120px;
  object-fit: cover;
  border-radius: 50%;
  display: block;
  margin: 0 auto;
}
    </style>

  </head>
   <body class="flex items-center justify-center min-h-screen px-4 py-6 overflow-hidden">
    <div class="flex w-full h-screen">
      <!-- Left Box -->
      <div class="box-left p-4 text-gray-100 flex flex-col justify-between">
        <div>
          <h1 class="text-2xl font-semibold mb-2">Weekly Housing Price Prediction With SageMaker Model</h1>
          <p class="mb-4 text-xs">
            Select housing specifications and predict! You are required to specify at least 3 fields in order to generate a prediction.
          </p>

          <hr>
          <br>

            <h1 class="text-lg font-semibold mb-2">About</h1>
          <p class="mb-4 text-xs">
        Based on recent housing data we aim to provide insights on Sydney rental market pricing. We produced two main
        deliverables, a list of agencies ranked by how much over or under the average market price and an application that
        is able to predict the price based on user input.
          </p>
        </div>

        <!--documentation section-->
              <div class="container" id="documentation">
    <h1 class="text-lg font-semibold mb-2">Documentation</h1>
    <div class="documentation-section">
      <p class="mb-4 text-xs">For detailed project documentation, please visit <a class="link" href="https://docs.google.com/document/d/1j7SKMtpVIPzhOkzZ7TffQCHxCKNeilz7gkUAR5KA22g/edit#heading=h.xdi7upsffmgs" target="_blank">this link</a>.</p>
      <div class="graph">
        Underpricing Agencies
        <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/Underpricing_Agencies.png">
      </div>
      <p class="mb-4 text-xs">Ranking of the top 5 agencies that list houses below their average predicted value in Sydney.</p>
      <div class="graph">
        Overpricing Agencies
        <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/Overpricing_Agencies.png">
      </div>

      <p class="mb-4 text-xs">Ranking of the top 5 agencies that list houses above their average predicted value in Sydney.</p>
    </div>
    </div>

<!-- Team Section -->
      <div class="container" id="team">
        <h1 class="text-lg font-semibold mb-2">Meet the Team</h1>
        <div class="team-section">
          <div class="team-member">
            <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/maggie_pic.jpg" alt="Maggie Estabrooks" />
            <div>
              <h3>Maggie Estabrooks</h3>
              <p class="mb-4 text-xs">
                 Electrical and Computer Engineering at Northeastern University </p>
            </div>
          </div>
          <div class="team-member">
            <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/diane_pic.jpg" alt="Diane Grant" />
            <div>
              <h3>Diane Grant</h3>
              <p class="mb-4 text-xs">Computer Science and Political Science at Northeastern University</p>
            </div>
          </div>
          <div class="team-member">
            <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/maddie_pic.jpg">
            <div>
              <h3>Maddie Lebiedzinski</h3>
              <p class="mb-4 text-xs">Computer Science and Design at Northeastern University</p>
            </div>
          </div>
          <div class="team-member">
            <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/spencer_pic.jpg" alt="Spencer Mendelsohn" />
            <div>
              <h3>Spencer Mendelsohn</h3>
              <p class="mb-4 text-xs">Computer Science with a concentration in Software at Northeastern University</p>
            </div>
          </div>
          <div class="team-member">
            <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/luis_pic.png" alt="Luis Sarmiento" />
            <div>
              <h3>Luis Sarmiento</h3>
              <p class="mb-4 text-xs">Computer Science and Game Development at Northeastern University</>
            </div>
          </div>
          <div class="team-member">
            <img src="https://team-housing-public-images.s3.ap-southeast-2.amazonaws.com/owen_pic.jpg" alt="Owen Simpson" />
            <div>
              <h3>Owen Simpson</h3>
              <p class="mb-4 text-xs">Computer Science with a concentration in Software at Northeastern University</p>
            </div>
          </div>
        </div>
      </div>

  </div>

      <!-- Right Box -->
      <div class="box-right flex flex-col justify-between">
        <h3 id="loading-data">Loading dropdown menus...</h3>
        <div class="space-y-6"> <!-- Increased vertical spacing -->
          <div class="flex mb-6 space-x-2"> <!-- Increased horizontal spacing -->
            <div class="flex-1">
              <label for="inputBedrooms" class="block mb-1 input-title text-xs">Enter Number of Bedrooms:</label>
              <input type="number" id="inputBedrooms" class="w-full input-field p-2 rounded highlighted text-xs" />
            </div>
            <div class="flex-1">
              <label for="inputBathrooms" class="block mb-1 input-title text-xs">Enter Number of Bathrooms:</label>
              <input type="number" id="inputBathrooms" class="w-full input-field p-2 rounded highlighted text-xs" />
            </div>
          </div>

          <div class="flex mb-6 space-x-2">
            <div class="flex-1">
              <label for="inputParking" class="block mb-1 input-title text-xs">Enter Number of Parking Spaces:</label>
              <input type="number" id="inputParking" class="w-full input-field p-2 rounded highlighted text-xs" />
            </div>
          </div>

          <div class="mb-6">
             <div class="flex mb-6 space-x-2">
            <div class="flex-1">
            <label for="inputArea" class="block mb-1 input-title text-xs">Enter Area:</label>
              <input type="range" id="inputArea" min="25" max="750" class="w-full input-field p-2 rounded highlighted text-xs" />
            <div class="text-xs mt-1">Value: <span id="rangeValue">0</span> square meters</div>
          </div>
               </div>


           <div class="mb-6">
             <div class="flex-1">
        <label for="propertyType" class="block mb-1 input-title text-xs">* Select Property Type:</label>
        <select id="propertyType" class="w-full input-field p-2 rounded highlighted text-xs" required>
          <option value="">Select a property type</option>
          <option value="Unit">Unit</option>
          <option value="House">House</option>
        </select>
               </div>
             </div>

          <div class="mb-6"> <!-- Increased vertical spacing -->
            <label for="Locality" class="block mb-1 input-title text-xs">Select Locality:</label>
            <select id="Locality" class="w-full input-field p-2 rounded highlighted text-xs">
              <option value="">Select a locality</option>
            </select>
          </div>

          <div class="flex mb-6 space-x-2"> <!-- Increased horizontal spacing -->
            <div class="flex-1">
              <label for="Agency" class="block mb-1 input-title text-xs">Select Agency:</label>
              <select id="Agency" class="w-full input-field p-2 rounded highlighted text-xs">
                <option value="">Select an agency</option>
              </select>
            </div>
            <div class="flex-1">
              <label for="Agent" class="block mb-1 input-title text-xs">Select Agent:</label>
              <select id="Agent" class="w-full input-field p-2 rounded highlighted text-xs">
                <option value="">Select an agent</option>
              </select>
            </div>
          </div>

          <div class="mb-6"> <!-- Increased vertical spacing -->
            <label for="Month" class="block mb-1 input-title text-xs">Select Listed Month:</label>
            <select id="Month" class="w-full input-field p-2 rounded highlighted text-xs">
              <option value="">Select listed month</option>
              <option value="Jan">January</option>
              <option value="Feb">February</option>
              <option value="Mar">March</option>
              <option value="Apr">April</option>
              <option value="May">May</option>
              <option value="Jun">June</option>
              <option value="Jul">July</option>
              <option value="Aug">August</option>
              <option value="Sep">September</option>
              <option value="Oct">October</option>
              <option value="Nov">November</option>
              <option value="Dec">December</option>
            </select>
          </div>
        </div>

        <div class="mt-10"> <!-- Increased vertical spacing -->
          <button id="predictButton" class="w-full py-2 rounded text-white button" disabled>
            Predict Price (AUD$/wk)
          </button>
          <div id="message" class="mt-2 p-2 bg-gray-700 rounded"></div>
        </div>
      </div>
    </div>

      <script>
        // Add event listeners to check the fields when they change
        document.querySelectorAll("input, select").forEach((element) => {
          element.addEventListener("input", checkFields);
        });

        // Update the displayed range value
        const inputArea = document.getElementById("inputArea");
        const rangeValue = document.getElementById("rangeValue");

        inputArea.addEventListener("input", () => {
          rangeValue.textContent =
            inputArea.value === "0" ? "None" : inputArea.value;
          checkFields();
        });

        // Initial check to set the button state on load
        checkFields();
        document.addEventListener("DOMContentLoaded", getData);

        // Check if at least two other fields are filled besides the property type
        function checkFields() {
          const inputBedrooms = document.getElementById("inputBedrooms").value;
          const inputBathrooms =
            document.getElementById("inputBathrooms").value;
          const inputParking = document.getElementById("inputParking").value;
          const inputArea = document.getElementById("inputArea").value;
          const propertyType = document.getElementById("propertyType").value;
          const locality = document.getElementById("Locality").value;
          const agency = document.getElementById("Agency").value;
          const month = document.getElementById("Month").value;
          const agent = document.getElementById("Agent").value;

          let filledCount = 0;

          // Count filled fields
          if (inputBedrooms) filledCount++;
          if (inputBathrooms) filledCount++;
          if (inputParking) filledCount++;
          if (propertyType) filledCount++;
          // if (inputArea && inputArea !== "0") filledCount++;
          if (locality && locality !== "") filledCount++;
          if (agency && agency !== "") filledCount++;
          if (month && month !== "") filledCount++;
          if (agent && agent !== "") filledCount++;

          // Check if property type is selected and at least three fields are filled
          const predictButton = document.getElementById("predictButton");
          if (predictButton) {
            predictButton.disabled = !propertyType || filledCount < 3;
          }
        }

        async function getData() {
          console.log("Loading data...");

          const locality = document.getElementById("Locality").value;

          const res = await fetch("/api/manifest");
          console.log("Data loaded with status: ", res.status);

          if (res.ok) {
            const { localities, agencies, agents } = await res.json();

            // Function to populate a select element with options
            function populateSelect(elementId, options) {
              const selectElement = document.getElementById(elementId);
              options.forEach((optionText) => {
                const option = document.createElement("option");
                option.value = optionText.toLowerCase();
                option.textContent = optionText;
                selectElement.appendChild(option);
              });
            }

            // Populate the select elements
            populateSelect("Locality", localities);
            populateSelect("Agency", agencies);
            populateSelect("Agent", agents);

            checkFields();

            document.getElementById("loading-data").style.display = "none";
          }
        }
      </script>

    </div>
    <script>
      document
        .getElementById("predictButton")
        .addEventListener("click", async () => {
          document.getElementById("message");
          const messageDiv = document.getElementById("message");

          if (messageDiv.textContent === "Loading...") {
            // Exit if a request is already in progress
            return;
          }

          messageDiv.textContent = "Loading...";
          try {
            const response = await fetch("/api/predict", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                propertyType: document.getElementById("propertyType").value,
                bedrooms: document.getElementById("inputBedrooms").value,
                bathrooms: document.getElementById("inputBathrooms").value,
                floorArea: document.getElementById("inputArea").value,
                locality: document.getElementById("Locality").value,
                agencyName: document.getElementById("Agency").value,
              }),
            });

            if (!response.ok) {
              if ((response.headers["Content-Type"] = "application/json")) {
                const err = await response.json();
                throw new Error(err.error);
              } else {
                throw new Error("API Request failed");
              }
            }

            const result = await response.json();

            const pred = Math.round(result.prediction);

            messageDiv.textContent = `$${pred} per week`;
          } catch (err) {
            messageDiv.textContent =
              "An error occurred. Please try again: " + err.message;
          }
        });
    </script>
  </body>
</html>
